{% load static %}

{% block extra_css %}
  <link href="{% static 'scheduler/css/jquery.datetimepicker.css' %}" rel='stylesheet' />
{% endblock %}

{% block extra_js %}
  <script src="{% static 'scheduler/js/jquery.datetimepicker.full.js' %}"></script>
{% endblock %}

  <!-- Modal Trigger -->
  <!-- <a class="waves-effect waves-light btn modal-trigger" href="#modal1">Modal</a> -->

  <!-- Modal Structure -->
<!--   <div id="modal1" class="modal">
    <div class="modal-content">
 -->
<div id="modal1">
 
  <button data-formType="appointment" id="switch_form">Schedule Event</button>

  <form id="appointment_form" class="active" action="." method="POST">
    {% csrf_token %}

    {{ forms.appointment.as_p }}

    <p><input type="submit" value="Schedule"></p>
  </form>

  <form id="event_form" class="hidden" action="." method="POST">
    {% csrf_token %}

    {{ forms.event.as_p }}

    <p><input type="submit" value="Schedule"></p>
  </form>
</div>

<!--     </div>
    <div class="modal-footer">
      <a href="#!" class="modal-close waves-effect waves-green btn-flat">Agree</a>
    </div>
  </div> -->

<!-- TODO: start/end for event should be conditional
  if all day unchecked, show start / end
https://www.fusionbox.com/blog/detail/creating-conditionally-required-fields-in-django-forms/577/
-->

<!-- TODO: place CSS and Scripts in folders. Use \{\% extra js \%\} in this template -->
<style type="text/css">
  .hidden {
    height: 0px;
    visibility: hidden;
  }
  .active {
    visibility: visible;
  }
</style>

<script>
  $(function () {
    $("#id_datetime").datetimepicker({
      format: 'd/m/Y H:i',
    });
  });
</script>

<script type="text/javascript">
  document.getElementById('switch_form').addEventListener('click', function() {
    var reverse_of = {'appointment': 'event', 'event': 'appointment'};
    var active_form = this.dataset.formtype;
    var inactive_form = reverse_of[this.dataset.formtype];

    document.getElementById(active_form + '_form').classList.remove('active');
    document.getElementById(active_form + '_form').classList.add('hidden');
    document.getElementById(inactive_form + '_form').classList.remove('hidden');
    document.getElementById(inactive_form + '_form').classList.add('active');

    this.dataset.formtype = inactive_form;
    this.innerHTML = 'Schedule ' + active_form.charAt(0).toUpperCase() + active_form.slice(1);
  });
</script>

<script type="text/javascript">
  $('#id_service').change(function() {
    var service_id = $(this).val();
    var service_end = $(this).closest('form').find('.schedule_end_field')

    $.ajax({
      type: 'GET',
      url: 'http://127.0.0.1:8000/ajax/event_service_duration/', // TODO - add as data-attr
      data: {
        'service_id': service_id
      },
      success: function (response) {
        console.log('success');
        var duration = JSON.parse(response["duration"]);
        var end_time = moment()
      },
      error: function (xhr, status, error) {
        console.log('error')
      }
    })
  })
</script>

<!-- <script type="text/javascript">
  document.addEventListener('DOMContentLoaded', function() {
    var options = {};
    var elems = document.querySelectorAll('.modal');
    var instances = M.Modal.init(elems, options);
  })
</script> -->